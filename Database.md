# Базы данных

## Виды баз данных

1. [Текстовые](#Текстовые)
0. [Иерархические](#Иерархические)
0. [Сетевые](#Сетевые)
0. [Поисковые](#Поисковые)
0. [Резидентные](#Резидентные)
0. [Реляционные](#Реляционные)
0. [С широкими столбцами](#с-широкими-столбцами)
0. [Столбчатые(колончатые)](#столбчатыеколончатые)
0. [Документоориентированные](#документоориентированные)
0. [Графовые](#графовые)
0. [Временныe ряды](#временныe-ряды)



[SQL](#sql)

1. MSSQL
2. MySQL
  - MyISAM
  - ACID - требования к транзакционной системе
  - Maria
  - InnoDB
3. PostgreSQL
  
  
### Текстовые

Информация собирается в текстовый формат – *txt*, *csv* и др. Различные типы таблуляции, проивольно Для разделения полей применяются пробелы, табуляция, запятые, точка с запятой и двоеточие.

> **Примеры**: etc/passwd и etc/fstab; файлы: csv, ini, toml, json, env и др.

✅ Просто использовать. 

✅ Достаточно текстового редактора.

✅ Удобно работать с конфигурационными данными приложений.

⛔ Сложно установить связи между компонентами данных.

⛔ Не для всех типов информации.


### Иерархические

Древовидная структура хранения информации. Отношения между объектами реализованы в виде физических указателей.

> **Примеры**: файловыe системы; DNS и LDAP-соединения; OPC UA ноды; структура JSON файлов.

⛔ Не поддерживает связи `многие-ко-многим`.

### Сетевые

Сложныe иерархические отношения в которых может быть не один родитель у объекта.

> **Примеры**: IDMS — специализированная СУБД для мейнфреймов.

### Поисковые

* Подходит для объемных текстов. 
* Поиск по любому значению, словам.

> **Примеры**: *Elastic*.

✅ Хорошо масштабируются.

⛔ Плохая аналитическая поддержка.

⛔ Подходит только для пакетных вставок.

### Резидентные

* Сведения хранятся в оперативной памяти. 
* Обычно это хэш-таблица (ключ-значение) или столбцы.

> **Примеры**: *Redis*, *Apache Ignite*, *Tarantool*.

✅ Данные обрабатываются быстро.

✅ Максимально короткое время отклика.

✅ Быстрая запись, чтение

⛔ Необходимо много ресурсов:
  - оперативная память,
  - бесперебойное питание,
  - дорогое масштабирование.


### Реляционные

* Формируются данные в столбца и строки, строки - значения, стролбцы - поля(свойства).
* Взаимоотношение строится посредсвом внешних ключей - ссылок на другие таблицы.
* Запросы формируют с помощью структурированного языка `SQL`:
  - делать выборки,
  - проводить агрегации и группировки,
  - изменять и удалять данные,
  - модифицировать структуру БД (создавать таблицы, поля), 
  - управлять доступом пользователей к тем или иным операциям и пр.


Проектиркются БД с позиций `нормализации` – минимизации избыточности при описании свойств объектов.

* Реляционные: *MySQL*, *Oracle DB*, *PostgreSQL*, *SQLite*.

✅⛔ Жесткая структуризация и типизация сведений об объектах


### С широкими столбцами

* Быстрый запрос больших объёмов данных.
* Сведения хранятся в виде записей `ключ-значение`
* Быстрая запись построчно и быстрое чтение по ключу.

> **Примеры**: *Cassandra*, *Google BigTable*, *HBase*.

✅ Хорошо масштабируются.

✅ Механизмов обнаружения мошенничества.


### Столбчатые(колончатые)

* Данные хранятся в столбцах в отдельных файлах.
* Доступ к данным на основе проекций.

> **Примеры**: *Clickhouse*, *Vertica*.

✅ Поддержка аналитики. 

✅ Удобного масштабирования.

⛔ Подходит только для пакетных вставок.

### Документоориентированные

✅ Хранится несвязанная информация в больших объёмах.

✅ Нет привязки к схеме.

✅ Сложный типы данных.

✅ Быстрая разработка.

⛔ Отсутствие хорошей аналитической поддержки.

⛔ Слабая поддержки транзакций.

⛔ Сложности с масштабированием.


> **Примеры**: *MongoDB*, *CouchDB*, *Couchbase*, *RethinkDB*.

### Графовые

* Данные хранятся в виде графов, то есть моделей с узлами и связями.
* Узлы — хранения сущностей
* Рёбра — взаимосвязи, которыми можно управлять

> Применяют в биоинформатике, моделирование социальных сетей для хранения взаимосвязий.

✅ Достаточно гибкие, с логичной структурой.

⛔ Плохо поддаются масштабированию.

⛔ Особый язык запросов SPARQL.


> **Примеры**: *OrientDB*, *Neo4j*, *JanusGraph*, *Dgraph*.

### Временныe ряды

* Ориентированы на запись.
* Постоянная обработки потока входных данных.

> **Примеры**: 
* OpenTSDB
* Prometheus
* InfluxDB
* TimescaleDB

## SQL

* Structured Query Language — «язык структурированных запросов».
* Декларативный язык программирования.

> Декларати́вное программи́рование — парадигма программирования, в которой задаётся спецификация решения задачи, то есть описывается ожидаемый результат, а не способ его получения. Противоположностью декларативного является императивное программирование, при котором на том или ином уровне детализации требуется описание последовательности шагов для решения задачи. В качестве примеров декларативных языков обычно приводят HTML и SQL.

* Появился в 1974.
* К концу 1986 года использование языка SQL в качестве основного для работы с данными в СУБД стало практически повсеместным.
* Множество диалектов.

**Операторы SQL**

* операторы определения данных (Data Definition Language, DDL):
  - CREATE создаёт объект базы данных (саму базу, таблицу, представление, пользователя и так далее),
  - ALTER изменяет объект,
  - DROP удаляет объект;
* операторы манипуляции данными (Data Manipulation Language, DML):
  - SELECT выбирает данные, удовлетворяющие заданным условиям,
  - INSERT добавляет новые данные,
  - UPDATE изменяет существующие данные,
  - DELETE удаляет данные;
* операторы определения доступа к данным (Data Control Language, DCL):
  - GRANT предоставляет пользователю (группе) разрешения на определённые операции с объектом,
  - REVOKE отзывает ранее выданные разрешения,
  - DENY задаёт запрет, имеющий приоритет над разрешением;
* операторы управления транзакциями (Transaction Control Language, TCL):  
  - COMMIT применяет транзакцию,
  - ROLLBACK откатывает все изменения, сделанные в контексте текущей транзакции,
  - SAVEPOINT делит транзакцию на более мелкие участки.

### MySQL

MySQL — свободная реляционная система управления базами данных. Разработку и поддержку MySQL осуществляет корпорация Oracle.

#### Типы таблиц

##### MyISAM

* Основана на принципах ISAM (англ. Indexed Sequential Access Method — индексно-последовательный метод доступа).
  - Индексы (хэш-таблица, хранящая указатели на данные) хранятся отдельно от данных и они малы.
  >Разработано IBM для мейнфреймов в 1963 году
* C версий MySQL 3.x, до версий MySQL 5.5 являлась системой хранения по умолчанию.
* Таблицы платформенно-независимые.
* По умолчанию можно создать 32 индекса, но если все типа tree то 64.
* Быстрые запросы на чтение, т.к. нет транзакций и внешних ключей.
* При модификации и добавлении таблица блокируется вся таоблица.
* Низкая надежность, не выполняет требования ACID, не безопасны для транзакций.
* Медленная сортировка безиндексовых данных из-за операций fopen() и fwrite().
* Пикова нагрузка 400 клиентов, при размере БД 2-3 Гб.
* Размер таблицы может достигать 256 ТБ.
* Могут быть сжаты в таблицы только для чтения для экономии места.


##### ACID - требования к транзакционной системе

> Требования ACID были в основном сформулированы в конце 70-х годов Джимом Греем

* *Atomicity — Атомарность*
Атомарность гарантирует, что никакая транзакция не будет зафиксирована в системе частично. Будут либо выполнены все её подоперации, либо не выполнено ни одной. Поскольку на практике невозможно одновременно и атомарно выполнить всю последовательность операций внутри транзакции, вводится понятие «отката» (rollback): если транзакцию не удаётся полностью завершить, результаты всех её до сих пор произведённых действий будут отменены и система вернётся во «внешне исходное» состояние — со стороны будет казаться, что транзакции и не было (естественно, счётчики, индексы и другие внутренние структуры могут измениться, но, если СУБД запрограммирована без ошибок, это не повлияет на внешнее её поведение).

* *Consistency — Согласованность*
Транзакция, достигающая своего нормального завершения (EOT — end of transaction, завершение транзакции) и тем самым фиксирующая свои результаты, сохраняет согласованность базы данных. Другими словами, каждая успешная транзакция по определению фиксирует только допустимые результаты. Это условие является необходимым для поддержки четвёртого свойства.
Согласованность является более широким понятием. Например, в банковской системе может существовать требование равенства суммы, списываемой с одного счёта, сумме, зачисляемой на другой. Это бизнес-правило и оно не может быть гарантировано только проверками целостности, его должны соблюсти программисты при написании кода транзакций. Если какая-либо транзакция произведёт списание, но не произведёт зачисления, то система останется в некорректном состоянии и свойство согласованности будет нарушено.
Наконец, ещё одно замечание касается того, что в ходе выполнения транзакции согласованности не требуется. В нашем примере списание и зачисление будут, скорее всего, двумя разными подоперациями и между их выполнением внутри транзакции будет видно несогласованное состояние системы. Однако не нужно забывать, что при выполнении требования изолированности (см. ниже) никаким другим транзакциям эта несогласованность не будет видна. А атомарность гарантирует, что транзакция либо будет полностью завершена, либо ни одна из операций транзакции не будет выполнена. Тем самым эта промежуточная несогласованность является скрытой.

* *Isolation — Изолированность*
Во время выполнения транзакции параллельные транзакции не должны оказывать влияния на её результат. Изолированность — требование дорогое, поэтому в реальных БД существуют режимы, не полностью изолирующие транзакцию (уровни изолированности Repeatable Read и ниже).

* *Durability — Прочность*
Независимо от проблем на нижних уровнях (к примеру, обесточивание системы или сбои в оборудовании) изменения, сделанные успешно завершённой транзакцией, должны остаться сохранёнными после возвращения системы в работу. Другими словами, если пользователь получил подтверждение от системы, что транзакция выполнена, он может быть уверен, что сделанные им изменения не будут отменены из-за какого-либо сбоя.

##### Maria

> Добавлено в MySQL 5.1. Начиная с версии 5.2.x — Aria.

* Расширенная версия хранилища MyISAM.
* В случае краха производится откат результатов.
* Возможность восстановления состояния из любой точки.
* Новый формат «rows-in-block», использующий страничный способ хранения данных, при котором данные в столбцах могут кэшироваться.
* Размер страницы данных равен 8 Кб (в MyISAM 1 Кб), что позволяет достичь более высокой производительности для индексов по полям фиксированного размера, но медленнее в случае индексирования ключей переменной длины.

##### InnoDB

> Добавлено в MySQL версии 3.23 в середине 2001 года как экспериментальная. В версии 4.0 InnoDB входил в стандартную поставку, а в 5.5 как основным хранилищем по умолчанию.

* Обеспечивающие соответствие требованиям ACID.
* Транзакционности и блокировки данных на уровне строки.
* Поддержка внешнего ключа (декларативная ссылочная целостность).
* Начиная с версии MySQL 5.6.4, в Innodb доступен полнотекстовый поиск.
* Размер таблицы InnoDB может достигать 64 ТБ.

### MSSQL

Microsoft SQL Server — система управления реляционными базами данных (РСУБД), разработанная корпорацией Microsoft. Основной используемый язык запросов — Transact-SQL.
Transact-SQL (T-SQL) — процедурное расширение языка SQL:

* управляющие операторы,
* локальные и глобальные переменные,
* различные дополнительные функции для обработки строк, дат, математики и т. п.,
* поддержка аутентификации Microsoft Windows.

### PostgreSQL

Свободная объектно-реляционная система управления базами данных (СУБД).

#### Типы таблиц
